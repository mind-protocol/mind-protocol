#!/usr/bin/env bash
# Enforce membrane discipline: only Git Runner commits are allowed.

set -euo pipefail

if [[ "${GIT_RUNNER:-}" == "1" ]]; then
  exit 0
fi

COMMIT_MSG_FILE="$(git rev-parse --git-path COMMIT_EDITMSG 2>/dev/null || true)"
if [[ -n "${COMMIT_MSG_FILE}" && -f "${COMMIT_MSG_FILE}" ]]; then
  if grep -q "\[git-runner\]" "${COMMIT_MSG_FILE}"; then
    exit 0
  fi
fi

echo "‚ùå Commit blocked. Use tool.request.git.commit (Git Runner)."
echo "   Set GIT_RUNNER=1 or include [git-runner] in the commit message if this was invoked by the runner."
exit 1
